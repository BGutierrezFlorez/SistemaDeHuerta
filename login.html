<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar sesión - SistemaDeHuerta</title>
    <link rel="stylesheet" href="css/index.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root{--card-bg:#ffffff;--accent:#1e7a2b;--muted:#6b6b6b}
        body{background:
            linear-gradient(rgba(11,58,7,0.55), rgba(14,90,16,0.55)),
            url('media/pngtree-a-healthy-harvest-of-vegetables-in-fertile-field-ready-for-picking-image_16808905.jpg') center 35%/cover no-repeat;
            color:#fff;font-family:'Outfit',system-ui,Arial,Helvetica,sans-serif}

        /* Keep header style from site (no override here) so index stays identical */

        /* Center the auth card in the middle of the viewport */
        .auth-wrapper{display:flex;justify-content:center;align-items:center;padding:0 20px;min-height:100vh}
        .auth-card{width:100%;max-width:520px;background:rgba(255,255,255,0.97);color:#0b3a07;border-radius:14px;padding:26px 28px;box-shadow:0 18px 50px rgba(4,20,6,0.45);border:1px solid rgba(0,0,0,0.06)}
        .brand-row{display:flex;align-items:center;gap:12px;margin-bottom:8px}
        .brand-logo{width:48px;height:48px;border-radius:8px;background:linear-gradient(135deg,#1e7a2b,#3fb04a);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
        .card-title{font-size:22px;margin:0 0 4px}
        .card-sub{font-size:13px;color:var(--muted);margin-bottom:14px}
        .auth-card label{display:block;margin-top:8px;font-weight:600}
        .input-row{position:relative;margin-top:6px}
        .input-row input{width:100%;padding:12px 12px;border-radius:8px;border:1px solid #e6e6e6;font-size:14px;box-sizing:border-box}
        .input-icon{position:absolute;right:12px;top:50%;transform:translateY(-50%);color:#999;font-size:14px}
        .auth-actions{display:flex;gap:12px;align-items:center;margin-top:18px}
        .btn-contact{background:var(--accent);color:#fff;border:none;padding:12px 16px;border-radius:8px;cursor:pointer;min-width:140px}
        .btn-ghost{background:#f3f3f3;color:#0b3a07;border:none;padding:10px 16px;border-radius:8px;cursor:pointer}
        .auth-note{margin-top:12px;text-align:center;color:#666;font-size:13px}
        #feedback{margin-left:8px;flex:1;text-align:center;font-weight:600}
        @media(max-width:520px){.auth-card{padding:18px;margin:12px}.auth-actions{flex-direction:column-reverse;align-items:stretch}.btn-contact{width:100%}.input-row input{font-size:15px}}
        /* Make the testimonials section transparent on this page so background image shows */
        .testimonials-section{background-color:transparent;padding:40px 20px}
        .testimonials-container{background:transparent}
    </style>
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="logo"><a href="index.html">SistemaDeHuerta</a></div>
            <ul class="nav-links">
                <li><a href="index.html">Inicio</a></li>
                <li><a href="nosotros.html">Nosotros</a></li>
                <li><a href="servicio.html">Servicios</a></li>
                <li><a href="galeria.html">Galería</a></li>
                <li><a href="contacto.html">Contacto</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero eliminado: solo queda el acceso (formulario) como pidió el usuario -->

    <section class="testimonials-section">
        <div class="testimonials-container">
            <div class="auth-wrapper">
                <div class="auth-card">
                    <div class="brand-row">
                        <div class="brand-logo">SD</div>
                        <div>
                            <h2 class="card-title">Iniciar sesión</h2>
                            <div class="card-sub">Accede a tu cuenta para gestionar tus huertas y servicios</div>
                        </div>
                    </div>
                    <div id="alreadyAuth" style="display:none;margin-bottom:12px;padding:10px;background:#f0fff4;border-radius:6px;color:var(--accent);"></div>
                    <form id="loginForm">
                        <label for="email">Correo electrónico</label>
                        <div class="input-row">
                            <input id="email" name="email" type="email" placeholder="tu@correo.com" required>
                            <span class="input-icon"><i class="fas fa-envelope"></i></span>
                        </div>

                        <label for="password">Contraseña</label>
                        <div class="input-row">
                            <input id="password" name="password" type="password" placeholder="Contraseña" required>
                            <span class="input-icon"><i class="fas fa-lock"></i></span>
                        </div>

                        <div class="auth-actions">
                            <button type="submit" class="btn-contact">Ingresar</button>
                            <div id="feedback"></div>
                        </div>
                        <div style="margin-top:10px;text-align:right;">
                            <a href="#" id="forgotLink" style="font-size:13px;color:var(--accent);text-decoration:none;">¿Olvidaste tu contraseña?</a>
                        </div>
                    </form>
                    <p class="auth-note">¿No tienes cuenta? <a href="register.html">Regístrate</a></p>
                </div>
            </div>
        </div>
    </section>

    <script>
        async function hashPassword(password){
            const enc = new TextEncoder();
            const buf = await crypto.subtle.digest('SHA-256', enc.encode(password));
            return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
        }

        document.getElementById('loginForm').addEventListener('submit', async function(e){
            e.preventDefault();
            const email = document.getElementById('email').value.trim().toLowerCase();
            const password = document.getElementById('password').value;
            const feedback = document.getElementById('feedback');

            if(!email || !password){
                feedback.style.color = '#ffcccb';
                feedback.textContent = 'Completa los campos.';
                return;
            }

                const users = JSON.parse(localStorage.getItem('sdh_users') || '{}');
            const user = users[email];
            if(!user){
                feedback.style.color = '#ffcccb';
                feedback.textContent = 'Correo no registrado.';
                return;
            }

            const hash = await hashPassword(password);
            if(hash !== user.hash){
                feedback.style.color = '#ffcccb';
                feedback.textContent = 'Contraseña incorrecta.';
                return;
            }

            localStorage.setItem('sdh_auth', email);
            feedback.style.color = 'var(--primary-green)';
            feedback.textContent = 'Ingreso correcto. Redirigiendo...';
            setTimeout(()=> window.location.href = 'index.html', 800);
        });

        // Olvidaste contraseña: abrir cliente de correo con plantilla
        document.getElementById('forgotLink').addEventListener('click', function(e){
            e.preventDefault();
            const email = document.getElementById('email').value.trim();
            const subject = encodeURIComponent('Recuperación de contraseña - ' + (email || '')); 
            const body = encodeURIComponent('Hola,%0A%0ASolicito ayuda para recuperar mi contraseña.%0A%0AUsuario / Email: ' + (email || '') + '%0A%0AGracias.');
            window.location.href = 'mailto:info@sistemahuerta.com?subject=' + subject + '&body=' + body;
        });

        // If already authenticated, show notice and option to go to index
        (function checkAuth(){
            const auth = localStorage.getItem('sdh_auth');
            if(auth){
                const users = JSON.parse(localStorage.getItem('sdh_users') || '{}');
                const name = (users[auth] && users[auth].name) ? users[auth].name : auth;
                const el = document.getElementById('alreadyAuth');
                el.style.display = 'block';
                el.innerHTML = 'Ya has iniciado sesión como <strong>' + name + '</strong>. <a href="index.html">Ir al inicio</a>';
                document.getElementById('loginForm').style.display = 'none';
            }
        })();
    </script>

    <script src="js/index.js"></script>
</body>
</html>
